# Swin-Unet-RS-



==========================================================================================
第一阶段：训练一个“经验丰富的插值帮手（U-Net）

首先将JAXA高频卫星提供的、带有真实世界云层空缺的数据，作为“模板”，在高质量、时空连续的CMEMS模型数据上“雕刻”出最贴近现实的训练样本。

===========================================================================================







============================================================================================
第二阶段：训练一个能“鉴往知来”的“时空预报员”（Swin-Unet）

使用SwinUnet(基于swin transformer架构)

1.数据加载与预处理：
多源数据整合: 自动扫描指定文件夹（支持子文件夹），加载所有月份的CMEMS、JAXA和背景场数据。

========a.序列筛选 :=========== 
首先，找出三个数据源共有的日期。然后，从这些共有日期中，筛选出满足时间上连续（例如，连续8天）且空间上有效的序列。

空间有效性检查: 确保在一个连续序列中的每一天，其CMEMS数据在用户指定的经纬度范围内裁剪后，数据点数量都不为0。这是保证训练数据质量的关键一步。

========b.每日数据处理:=========

输入处理 (_process_one_day_input): 加载当天的JAXA数据和背景场数据，将它们堆叠为2通道张量。

标签处理 (_load_cmems_label): 加载当天对应的CMEMS数据作为标签。

坐标系统一 (重要细节): 在进行经纬度裁剪时，代码已内置逻辑，分别处理JAXA（纬度递减）和CMEMS（纬度递增）不同的坐标顺序，确保数据方向正确。

尺寸统一与数据清洗 (核心):

每日缩放 (_resize_tensor): 无论是输入还是标签，每一天的数据在加载后，都会被立即通过双线性插值平滑地**缩放（Resize）**到224x224的标准尺寸。我们不使用补白（Padding），以避免产生强烈的人工边界干扰模型学习。

数据清洗 (torch.clamp): 在归一化前，强制所有数据值都大于等于0，从根源上杜绝因负值或无效值在后续计算中产生nan。

========c.数据归一化:============

对清洗后的输入和标签数据，都进行log(1+x)的对数变换 (torch.log1p)。这可以压缩数据的动态范围，稳定训练过程，并让模型更好地学习低浓度和高浓度区域的模式。

序列构建 (__getitem__):

将处理好的每日数据，按history_len（例如5天）和forecast_len（例如3天）组合成最终的输入张量（10通道）和标签张量（3通道），送给模型进行训练。




===============================模型训练流程 (主程序)=========================================

数据划分: 脚本会自动将找到的所有CMEMS月份文件，划分为训练集（除最后一个月外的所有月份）和验证集（最后一个月）。

=====简单的硬件优化:=====

梯度累积 (Gradient Accumulation): 使用一个很小的物理批次大小（BATCH_SIZE=1），但将梯度累积多次（ACCUMULATION_STEPS=8）后再更新模型。这可以在有限的显存下，模拟大批量的训练效果，稳定学习过程。

自动混合精度 (AMP): 使用torch.cuda.amp，通过半精度计算来大幅降低显存占用并加速训练。

=====训练与验证循环:=====

训练阶段: 模型在训练集上进行学习，计算训练损失（Training Loss）。

验证阶段: 每个epoch结束后，模型会切换到评估模式，在独立的验证集上进行一次“模拟考试”，计算验证损失（Validation Loss）。

=====最佳模型保存:=======

脚本会持续追踪验证损失。只有当当前epoch的验证损失低于之前所有epoch的最低值时，才会将当前的模型权重保存下来。





